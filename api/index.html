<!DOCTYPE html>
<html lang="English">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API | Rallie.js</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e8009872.css" as="style"><link rel="preload" href="/assets/js/app.b890f0a6.js" as="script"><link rel="preload" href="/assets/js/2.3473cfcc.js" as="script"><link rel="preload" href="/assets/js/1.2d11cab2.js" as="script"><link rel="preload" href="/assets/js/25.65178a57.js" as="script"><link rel="prefetch" href="/assets/js/10.50e49c0b.js"><link rel="prefetch" href="/assets/js/11.c62b6b34.js"><link rel="prefetch" href="/assets/js/12.833572d5.js"><link rel="prefetch" href="/assets/js/13.57f11722.js"><link rel="prefetch" href="/assets/js/14.6ffe75b1.js"><link rel="prefetch" href="/assets/js/15.114dfd5c.js"><link rel="prefetch" href="/assets/js/16.ca6cb361.js"><link rel="prefetch" href="/assets/js/17.c2838453.js"><link rel="prefetch" href="/assets/js/18.3256f17f.js"><link rel="prefetch" href="/assets/js/19.2b1b3427.js"><link rel="prefetch" href="/assets/js/20.cc596018.js"><link rel="prefetch" href="/assets/js/21.7f8f7869.js"><link rel="prefetch" href="/assets/js/22.3f20ce36.js"><link rel="prefetch" href="/assets/js/23.a4908e7f.js"><link rel="prefetch" href="/assets/js/24.256f47ca.js"><link rel="prefetch" href="/assets/js/26.14b73353.js"><link rel="prefetch" href="/assets/js/27.0c99151b.js"><link rel="prefetch" href="/assets/js/28.214db946.js"><link rel="prefetch" href="/assets/js/29.dbe3c31d.js"><link rel="prefetch" href="/assets/js/3.ebfac746.js"><link rel="prefetch" href="/assets/js/30.067b3326.js"><link rel="prefetch" href="/assets/js/31.2b583d31.js"><link rel="prefetch" href="/assets/js/32.6fce60e1.js"><link rel="prefetch" href="/assets/js/33.70fb2dad.js"><link rel="prefetch" href="/assets/js/34.42a661c5.js"><link rel="prefetch" href="/assets/js/35.45e7a9c5.js"><link rel="prefetch" href="/assets/js/4.b86281c7.js"><link rel="prefetch" href="/assets/js/5.5b528aba.js"><link rel="prefetch" href="/assets/js/6.403fab2e.js"><link rel="prefetch" href="/assets/js/7.5b9b1097.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.03d43e08.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8009872.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Rallie.js" class="logo"> <span class="site-name can-hide">Rallie.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/introduction.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  API
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/api/" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/ralliejs/rallie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/introduction.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  API
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/api/" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/ralliejs/rallie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/api/" aria-current="page" class="active sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/#basic-types" class="sidebar-link">Basic Types</a></li><li class="sidebar-sub-header"><a href="/api/#createblock" class="sidebar-link">createBlock</a></li><li class="sidebar-sub-header"><a href="/api/#block" class="sidebar-link">Block</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/#name" class="sidebar-link">name</a></li><li class="sidebar-sub-header"><a href="/api/#state" class="sidebar-link">state</a></li><li class="sidebar-sub-header"><a href="/api/#methods" class="sidebar-link">methods</a></li><li class="sidebar-sub-header"><a href="/api/#events" class="sidebar-link">events</a></li><li class="sidebar-sub-header"><a href="/api/#initstate" class="sidebar-link">initState</a></li><li class="sidebar-sub-header"><a href="/api/#setstate" class="sidebar-link">setState</a></li><li class="sidebar-sub-header"><a href="/api/#watchstate" class="sidebar-link">watchState</a></li><li class="sidebar-sub-header"><a href="/api/#listenevents" class="sidebar-link">listenEvents</a></li><li class="sidebar-sub-header"><a href="/api/#addmethods" class="sidebar-link">addMethods</a></li><li class="sidebar-sub-header"><a href="/api/#load" class="sidebar-link">load</a></li><li class="sidebar-sub-header"><a href="/api/#activate" class="sidebar-link">activate</a></li><li class="sidebar-sub-header"><a href="/api/#connect" class="sidebar-link">connect</a></li><li class="sidebar-sub-header"><a href="/api/#run" class="sidebar-link">run</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/#env" class="sidebar-link">Env</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/#isentry" class="sidebar-link">isEntry</a></li><li class="sidebar-sub-header"><a href="/api/#freeze" class="sidebar-link">freeze</a></li><li class="sidebar-sub-header"><a href="/api/#unfreeze" class="sidebar-link">unfreeze</a></li><li class="sidebar-sub-header"><a href="/api/#use" class="sidebar-link">use</a></li><li class="sidebar-sub-header"><a href="/api/#conf" class="sidebar-link">conf</a></li><li class="sidebar-sub-header"><a href="/api/#config" class="sidebar-link">config</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="api"><a href="#api" class="header-anchor">#</a> API</h1> <h2 id="basic-types"><a href="#basic-types" class="header-anchor">#</a> Basic Types</h2> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">State</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Events</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Methods</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">BlockDeclare</span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> State<span class="token punctuation">;</span>
  events<span class="token operator">:</span> Events<span class="token punctuation">;</span>
  methods<span class="token operator">:</span> Methods<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="createblock"><a href="#createblock" class="header-anchor">#</a> createBlock</h2> <ul><li><p>Type:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">BlockDeclare</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Block<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token string">'events'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token string">'methods'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token string">'exports'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>Description: Creates a Block, accepting a globally unique block name as a parameter, and returns a <code>Block</code> instance.</p></li> <li><p>Example:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createBlock <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@rallie/block&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">MyBlock</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">incrementCount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function-variable function">logout</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myBlock <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createBlock</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyBlock<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;my-block&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="block"><a href="#block" class="header-anchor">#</a> Block</h2> <h3 id="name"><a href="#name" class="header-anchor">#</a> name</h3> <ul><li>Type: <code>string</code></li> <li>Description: The name of the Block.</li></ul> <h3 id="state"><a href="#state" class="header-anchor">#</a> state</h3> <ul><li>Type: <code>State</code></li> <li>Description: The state of the Block, which is read-only. To modify the state of a Block, the <a href="#setState">setState</a> method must be used.</li></ul> <h3 id="methods"><a href="#methods" class="header-anchor">#</a> methods</h3> <ul><li><p>Type: <code>Methods</code></p></li> <li><p>Description: The method invoker of the Block, which is read-only. To add methods to a Block, the <a href="#addMethods">addMethods</a> method must be used.</p></li> <li><p>Example:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// Add methods</span>
block<span class="token punctuation">.</span><span class="token function">addMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> success <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> success<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Invoke method</span>
block<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Login successfully&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="events"><a href="#events" class="header-anchor">#</a> events</h3> <ul><li><p>Type: <code>Events</code></p></li> <li><p>Description: The event invoker of the Block, which is read-only. To add event listeners to a Block, the <a href="#listenEvents">listenEvents</a> method must be used.</p></li> <li><p>Example:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// Listen to events</span>
block<span class="token punctuation">.</span><span class="token function">listenEvents</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">themeChange</span><span class="token operator">:</span> <span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">doChangeTheme</span><span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Trigger event</span>
block<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">themeChange</span><span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="initstate"><a href="#initstate" class="header-anchor">#</a> initState</h3> <ul><li>Type: <code>(value: State, isPrivate: boolean = false) =&gt; CreatedBlock</code></li> <li>Description: Initializes the state of the Block. A Block can only be initialized once. Calling <code>initState</code> multiple times will throw an error. If you want the state to be unmodifiable by other Blocks, pass <code>true</code> as the second parameter to indicate that the state is set as private.</li></ul> <h3 id="setstate"><a href="#setstate" class="header-anchor">#</a> setState</h3> <ul><li><p>Type: <code>((action: string, state: State) =&gt; void | Promise&lt;void&gt;) =&gt; Promise&lt;void&gt;</code></p></li> <li><p>Description: Modifies the state of the Block. The first parameter is a description of this operation.</p></li> <li><p>Example:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// Synchronously modify state</span>
block<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">&quot;add the count synchronously&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Asynchronously modify state</span>
<span class="token keyword">await</span> block<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">&quot;add the count asynchronously&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestLogIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  state<span class="token punctuation">.</span>user <span class="token operator">=</span> userInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="watchstate"><a href="#watchstate" class="header-anchor">#</a> watchState</h3> <ul><li><p>Type: <code>((state: State) =&gt; any) =&gt; Watcher</code></p></li> <li><p>Description: Listens to changes in the Block's state, implemented based on the <code>effect</code> method of <code>@vue/reactivity</code>. See examples for specific usage.</p></li> <li><p>Example:</p> <ul><li><p>Chained calling to watch state</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// Watch state</span>
<span class="token keyword">const</span> unwatch <span class="token operator">=</span> block
  <span class="token punctuation">.</span><span class="token function">watchState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token punctuation">(</span>newCount<span class="token punctuation">,</span> oldCount<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newCount<span class="token punctuation">,</span> oldCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Unwatch</span>
<span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>watchEffect</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// Watch state</span>
<span class="token keyword">const</span> watcher <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">watchState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> state<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Unwatch</span>
watcher<span class="token punctuation">.</span><span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h3 id="listenevents"><a href="#listenevents" class="header-anchor">#</a> listenEvents</h3> <ul><li>Type: <code>(events: Partial&lt;Events&gt;) =&gt; (eventName?: string) =&gt; void</code></li> <li>Description: Adds event listeners to the Block, and the return value is a function to cancel the event listening. The block name of the event caller can be obtained from the <code>this</code> context of the listening callback.</li> <li>Example:
<ul><li>Listen to events:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> cancelEvents <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">listenEvents</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">changeTheme</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> <span class="token punctuation">{</span> trigger<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> themeColor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Event caller is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>trigger<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token function">doChangeTheme</span><span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">changeLanguage</span><span class="token operator">:</span> <span class="token punctuation">(</span>lang<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">doChangeLanguage</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>Cancel listening to all events:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">cancelEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>Cancel listening to a single event<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">cancelEvents</span><span class="token punctuation">(</span><span class="token string">&quot;changeTheme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h3 id="addmethods"><a href="#addmethods" class="header-anchor">#</a> addMethods</h3> <ul><li>Type: <code>(methods: Partial&lt;Methods&gt;) =&gt; (methodName?: string) =&gt; void</code></li> <li>Description: Adds methods to the Block, and the return value is a function to remove the methods. The block name of the event caller can be obtained from the <code>this</code> context of the method callback.</li> <li>Example:
<ul><li>Add methods:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> removeMethods <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">addMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">logIn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> <span class="token punctuation">{</span> trigger<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Event caller is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>trigger<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">requestLogIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">logOut</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">requestLogOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>Remove all methods:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">removeMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>Remove a single method<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">removeMethods</span><span class="token punctuation">(</span><span class="token string">&quot;logIn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h3 id="load"><a href="#load" class="header-anchor">#</a> load</h3> <ul><li>Type: <code>(name: string) =&gt; Promise&lt;void&gt;</code></li> <li>Description: Loads the resources of a Block, with the argument being the name of the Block to be loaded.</li></ul> <h3 id="activate"><a href="#activate" class="header-anchor">#</a> activate</h3> <ul><li>Type: <code>(name: string) =&gt; Promise&lt;void&gt;</code></li> <li>Description: Activates a Block, with the argument being the name of the Block to be activated.</li></ul> <h3 id="connect"><a href="#connect" class="header-anchor">#</a> connect</h3> <ul><li>Type:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">BlockDeclare</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ConnectedBlock<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
</code></pre></div></li> <li>Description: Connects to a Block, receiving the name of the Block to be connected as the only parameter, and returns a <code>ConnectedBlock</code> that allows the use of the connected Block's state, events, and methods.</li> <li>Example:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">RemoteBlock</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">incrementCount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
    <span class="token function-variable function">logout</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> connectedBlock <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">connect</span><span class="token generic class-name"><span class="token operator">&lt;</span>RemoteBlock<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;remote&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <p>The <a href="#connect">connect</a> method will return a <code>ConnectedBlock</code>. Its state, event, and method-related APIs are a subset of the normal <a href="#block">Block</a> APIs, including <a href="#name">name</a>, <a href="#state">state</a>, <a href="#events">events</a>, <a href="#methods">methods</a>, <a href="#setstate">setState</a>, <a href="#watchstate">watchState</a>, and <a href="#listenevents">listenEvents</a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If the connected Block declares its state as private, calling <code>setState</code> to change the Block's state via <code>ConnectedBlock</code> will result in an error.</p></div> <p>The usage of the above properties and methods is completely consistent with the usage of Block.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>For a ConnectedBlock, to use its state, call its methods, or import its exposed objects, you should ensure that its state has been initialized, methods have been added, and objects have been exported. The connect operation does not load or activate the Block to be connected, so you should declare the Block to be connected as the current Block's <a href="/guide/advance.html#association-and-dependency">association or dependency</a>, or manually load or activate the Block to be connected.</p></div> <h3 id="run"><a href="#run" class="header-anchor">#</a> run</h3> <ul><li>Type: <code>(callback: (env: Env) =&gt; void | Promise&lt;void&gt;) =&gt; Promise&lt;void&gt;</code></li> <li>Description: Executes the passed callback function. The current Block's runtime environment can be obtained in the callback parameter, see <a href="#env">Env</a>.</li></ul> <h2 id="env"><a href="#env" class="header-anchor">#</a> Env</h2> <p>The runtime environment object of a Block, which can be obtained in the callback of the <a href="#run">run</a> method.</p> <h3 id="isentry"><a href="#isentry" class="header-anchor">#</a> isEntry</h3> <ul><li>Type: <code>boolean</code></li> <li>Description: Whether it is the entry environment. If a Block is the first application created in the application cluster, then when executing the Block's <code>run</code> method, its callback parameter <code>env.isEntry</code> is <code>true</code>, otherwise it is <code>false</code>.</li></ul> <h3 id="freeze"><a href="#freeze" class="header-anchor">#</a> freeze</h3> <ul><li>Type: <code>() =&gt; void</code></li> <li>Description: Freezes the current runtime environment, which is only effective when <code>env.isEntry</code> is <code>true</code>. After the runtime environment is frozen, the middleware and configurations applied by non-entry environment Blocks will not take effect.</li></ul> <h3 id="unfreeze"><a href="#unfreeze" class="header-anchor">#</a> unfreeze</h3> <ul><li>Type: <code>() =&gt; void</code></li> <li>Description: Unfreezes the current runtime environment, which is only effective when <code>env.isEntry</code> is <code>true</code>.</li></ul> <h3 id="use"><a href="#use" class="header-anchor">#</a> use</h3> <ul><li>Type: <code>(middleware: (ctx: Context, next: () =&gt; Promise&lt;void&gt;) =&gt; void) =&gt; void</code></li> <li>Description: Applies resource loading middleware, usage refers to <a href="/guide/advance.html#middleware">middleware</a>, the type of context is:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// The name of the Block to be loaded</span>
  conf<span class="token operator">:</span> ConfType<span class="token punctuation">;</span> <span class="token comment">// The configuration of the runtime environment, refer to env.conf</span>
  <span class="token function-variable function">loadScript</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    script<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>HTMLScriptElement<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> HTMLScriptElement
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Method to insert script tags</span>
  <span class="token function-variable function">loadLink</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    link<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>HTMLLinkElement<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> HTMLLinkElement
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Method to insert link tags</span>
  <span class="token punctuation">[</span>other<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// Middleware can add methods and properties to context</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="conf"><a href="#conf" class="header-anchor">#</a> conf</h3> <ul><li>Type:<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">ConfType</span> <span class="token punctuation">{</span>
  assets<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span>
    <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      js<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
      css<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>other<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>Description: The global configuration of the runtime environment, which can be configured through <code>env.config</code>. The <code>assets</code> property is the resource path information of the application cluster. The innermost middleware of rallie's onion middleware model will look for and load application resources in <code>assets</code> based on the Block's name.</li></ul> <h3 id="config"><a href="#config" class="header-anchor">#</a> config</h3> <ul><li>Type: <code>(conf: ConfType) =&gt; void</code></li> <li>Description: Configures the runtime environment. When configuring <code>assets</code>, the information will be appended and not overwritten.<div class="language-ts extra-class"><pre class="language-ts"><code>env<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  assets<span class="token operator">:</span> <span class="token punctuation">{</span>
    bar<span class="token operator">:</span> <span class="token punctuation">{</span>
      js<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bar.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
env<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  assets<span class="token operator">:</span> <span class="token punctuation">{</span>
    foo<span class="token operator">:</span> <span class="token punctuation">{</span>
      js<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;foo.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>assets<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* The result will be printed as:
  {
    bar: {
      js: ['bar.js']
    },
    foo: {
      js: ['foo.js']
    }
  }
*/</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ralliejs/docs/edit/main/api/index.md" target="_blank" rel="noopener noreferrer">Edit in Github</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b890f0a6.js" defer></script><script src="/assets/js/2.3473cfcc.js" defer></script><script src="/assets/js/1.2d11cab2.js" defer></script><script src="/assets/js/25.65178a57.js" defer></script>
  </body>
</html>
