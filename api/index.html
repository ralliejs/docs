<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API | Rallie.js</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.ec4df931.css" as="style"><link rel="preload" href="/assets/js/app.5c31735b.js" as="script"><link rel="preload" href="/assets/js/2.2db9e384.js" as="script"><link rel="preload" href="/assets/js/9.ae449379.js" as="script"><link rel="prefetch" href="/assets/js/10.dc3d0e9b.js"><link rel="prefetch" href="/assets/js/11.2f5da79b.js"><link rel="prefetch" href="/assets/js/12.534e2fcc.js"><link rel="prefetch" href="/assets/js/13.ab664658.js"><link rel="prefetch" href="/assets/js/3.370e6348.js"><link rel="prefetch" href="/assets/js/4.4c4e0ad9.js"><link rel="prefetch" href="/assets/js/5.24503e2b.js"><link rel="prefetch" href="/assets/js/6.0a337b1b.js"><link rel="prefetch" href="/assets/js/7.f7266eab.js"><link rel="prefetch" href="/assets/js/8.e80906c7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ec4df931.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Rallie.js" class="logo"> <span class="site-name can-hide">Rallie.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/introduction.html" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  API
</a></div> <a href="https://github.com/ralliejs/rallie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/introduction.html" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  API
</a></div> <a href="https://github.com/ralliejs/rallie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/api/" aria-current="page" class="active sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/#app" class="sidebar-link">App</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/#constructor" class="sidebar-link">constructor</a></li><li class="sidebar-sub-header"><a href="/api/#name" class="sidebar-link">name</a></li><li class="sidebar-sub-header"><a href="/api/#state" class="sidebar-link">state</a></li><li class="sidebar-sub-header"><a href="/api/#methods" class="sidebar-link">methods</a></li><li class="sidebar-sub-header"><a href="/api/#events" class="sidebar-link">events</a></li><li class="sidebar-sub-header"><a href="/api/#setstate" class="sidebar-link">setState</a></li><li class="sidebar-sub-header"><a href="/api/#watchstate" class="sidebar-link">watchState</a></li><li class="sidebar-sub-header"><a href="/api/#listenevents" class="sidebar-link">listenEvents</a></li><li class="sidebar-sub-header"><a href="/api/#addmethods" class="sidebar-link">addMethods</a></li><li class="sidebar-sub-header"><a href="/api/#load" class="sidebar-link">load</a></li><li class="sidebar-sub-header"><a href="/api/#activate" class="sidebar-link">activate</a></li><li class="sidebar-sub-header"><a href="/api/#destroy" class="sidebar-link">destroy</a></li><li class="sidebar-sub-header"><a href="/api/#connect" class="sidebar-link">connect</a></li><li class="sidebar-sub-header"><a href="/api/#run" class="sidebar-link">run</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/#connector" class="sidebar-link">Connector</a></li><li class="sidebar-sub-header"><a href="/api/#registerapp" class="sidebar-link">registerApp</a></li><li class="sidebar-sub-header"><a href="/api/#registrant" class="sidebar-link">Registrant</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/#relateto" class="sidebar-link">relateTo</a></li><li class="sidebar-sub-header"><a href="/api/#relyon" class="sidebar-link">relyOn</a></li><li class="sidebar-sub-header"><a href="/api/#onbootstrap" class="sidebar-link">onBootstrap</a></li><li class="sidebar-sub-header"><a href="/api/#onactivate" class="sidebar-link">onActivate</a></li><li class="sidebar-sub-header"><a href="/api/#ondestroy" class="sidebar-link">onDestroy</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/#env" class="sidebar-link">Env</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/#isentry" class="sidebar-link">isEntry</a></li><li class="sidebar-sub-header"><a href="/api/#freeze" class="sidebar-link">freeze</a></li><li class="sidebar-sub-header"><a href="/api/#unfreeze" class="sidebar-link">unfreeze</a></li><li class="sidebar-sub-header"><a href="/api/#use" class="sidebar-link">use</a></li><li class="sidebar-sub-header"><a href="/api/#conf" class="sidebar-link">conf</a></li><li class="sidebar-sub-header"><a href="/api/#config" class="sidebar-link">config</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="api"><a href="#api" class="header-anchor">#</a> API</h1> <h2 id="app"><a href="#app" class="header-anchor">#</a> App</h2> <p>App可以直接通过<code>import { App } from 'rallie'</code>导入</p> <h3 id="constructor"><a href="#constructor" class="header-anchor">#</a> constructor</h3> <ul><li>类型：<code>(name: string, options?: AppOptions) =&gt; void</code></li> <li>说明：App的构造函数, 直接通过<code>new</code>操作符创建App实例。接收两个参数，第一个参数是App的名称，必须全局唯一；第二个参数是App的初始化选项，包含两个选项<code>state</code>和<code>isPrivate</code>，分别表示状态的初始值和状态是否可以被<a href="#connector">Connector</a>更改。使用typescript时，可以接收三个泛型参数，分别声明App的状态，事件和方法的类型</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rallie'</span>

<span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  user<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Events</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">incrementCount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Methods</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
  <span class="token function-variable function">logout</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Events<span class="token punctuation">,</span> Methods<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token string">'my-app'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span> 
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'rallie'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="name"><a href="#name" class="header-anchor">#</a> name</h3> <ul><li>类型：<code>string</code></li> <li>说明：App的名称</li></ul> <h3 id="state"><a href="#state" class="header-anchor">#</a> state</h3> <ul><li>类型：<code>State</code></li> <li>说明： App的状态，是只读的，要修改App的状态必须使用<a href="#setstate">setState</a>方法</li></ul> <h3 id="methods"><a href="#methods" class="header-anchor">#</a> methods</h3> <ul><li>类型：<code>Methods</code></li> <li>说明：App的方法调用器，是只读的，要给App添加方法，必须使用<a href="#addmethods">addMethods</a>方法</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 添加方法</span>
app<span class="token punctuation">.</span><span class="token function">addMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">login</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> success <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> success      
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用方法</span>
app<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Login successfully'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="events"><a href="#events" class="header-anchor">#</a> events</h3> <ul><li>类型：<code>Events</code></li> <li>说明：App的事件调用器，是只读的，要给App添加事件监听，必须使用<a href="#listenevents">listenEvents</a>方法</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 监听事件</span>
app<span class="token punctuation">.</span><span class="token function">listenEvents</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">themeChange</span><span class="token operator">:</span> <span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">doChangeTheme</span><span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 触发事件</span>
app<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">themeChange</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="setstate"><a href="#setstate" class="header-anchor">#</a> setState</h3> <ul><li>类型：<code>((action: string, state: State) =&gt; void | Promise&lt;void&gt;) =&gt; Promise&lt;void&gt;</code></li> <li>说明：修改App的状态，第一个参数是对本次操作的描述</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token comment">// 同步修改状态</span>
  app<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">'add the count synchronously'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>count<span class="token operator">++</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 异步修改状态</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">'add the count synchronously'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestLogIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      state<span class="token punctuation">.</span>user <span class="token operator">=</span> userInfo
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="watchstate"><a href="#watchstate" class="header-anchor">#</a> watchState</h3> <ul><li>类型：<code>((state: State，isWatchingEffect?: boolean) =&gt; any)) =&gt; Watcher</code></li> <li>说明：监听App的状态变化，基于<code>@vue/reactivity</code>的effect实现的。具体使用方式见示例</li> <li>示例：
<ul><li>链式调用监听状态<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 监听状态</span>
<span class="token keyword">const</span> unwatch <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">watchState</span><span class="token punctuation">(</span>state <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">do</span><span class="token punctuation">(</span><span class="token punctuation">(</span>newCount<span class="token punctuation">,</span> oldCount<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newCount<span class="token punctuation">,</span> oldCount<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 取消监听</span>
<span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>watchEffect<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 监听状态</span>
<span class="token keyword">const</span> watcher <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">watchState</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> isWatchingEffect<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isWatchingEffect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> state<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 取消监听</span>
watcher<span class="token punctuation">.</span><span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <h3 id="listenevents"><a href="#listenevents" class="header-anchor">#</a> listenEvents</h3> <ul><li>类型：<code>(events: Partial&lt;Events&gt;) =&gt; (eventName?: string) =&gt; void</code></li> <li>说明：给App添加事件监听，返回值是用来取消事件监听的函数</li> <li>示例：
<ul><li>监听事件：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> cancelEvents <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listenEvents</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">changeTheme</span><span class="token operator">:</span> <span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">doChangeTheme</span><span class="token punctuation">(</span>themeColor<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">changeLanguage</span><span class="token operator">:</span> <span class="token punctuation">(</span>lang<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">doChangeLanguage</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>批量取消监听事件：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">cancelEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>取消监听单个事件<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">cancelEvents</span><span class="token punctuation">(</span><span class="token string">'changeTheme'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <h3 id="addmethods"><a href="#addmethods" class="header-anchor">#</a> addMethods</h3> <ul><li>类型：<code>(methods: Partial&lt;Methods&gt;) =&gt; (methodName?: string) =&gt; void</code></li> <li>说明：给App添加方法，返回值是用来取消方法的函数</li> <li>示例：
<ul><li>添加方法：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> cancelMethods <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">addMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">logIn</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">requestLogIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">logOut</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">requestLogOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>批量取消方法：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">cancelMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>取消单个方法<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">cancelMethods</span><span class="token punctuation">(</span><span class="token string">'logIn'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <h3 id="load"><a href="#load" class="header-anchor">#</a> load</h3> <ul><li>类型：<code>(name: string, ctx?: Context) =&gt; Promise&lt;void&gt;</code></li> <li>说明：加载App的资源，接收两个参数，第一个参数是要加载的App的名字，第二个参数是传递给资源加载<a href="/guide/advance.html#中间件">中间件</a>的上下文</li></ul> <h3 id="activate"><a href="#activate" class="header-anchor">#</a> activate</h3> <ul><li>类型：<code>(name: string, data?: any, ctx?: Context) =&gt; Promise&lt;void&gt;</code></li> <li>说明：激活App，接收三个参数，第一个参数是要激活的App的名字，第二个参数是传递给激活的App的<a href="/guide/advance.html#生命周期">生命周期</a>方法的参数，第三个参数是传递给资源加载<a href="/guide/advance.html#中间件">中间件</a>的上下文</li></ul> <h3 id="destroy"><a href="#destroy" class="header-anchor">#</a> destroy</h3> <ul><li>类型：<code>(name: string, data?: any) =&gt; Promise&lt;void&gt;</code></li> <li>说明：销毁App，接收两个参数，第一个参数是要销毁的App的名字，第二个参数是传递给销毁的App的<a href="/guide/advance.html#生命周期">生命周期</a>方法的参数</li></ul> <h3 id="connect"><a href="#connect" class="header-anchor">#</a> connect</h3> <ul><li>类型：<code>(name: string) =&gt; Connector</code></li> <li>说明：连接App，接收要连接的App的名字作为唯一参数，返回一个<a href="#connector">Connector</a>对象用于使用被连接App的状态，事件和方法。使用connect方法时可以传入类似App构造函数的三个泛型参数，用来声明要连接的App的状态、事件和方法的类型</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  lang<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Events</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">changeLang</span><span class="token operator">:</span> <span class="token punctuation">(</span>lang<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> 
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Methods</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> remoteApp <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">connect</span><span class="token generic class-name"><span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Events<span class="token punctuation">,</span> Methods<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'remote'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>remoteApp<span class="token punctuation">.</span>state<span class="token punctuation">.</span>lang<span class="token punctuation">)</span>
remoteApp<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">changeLang</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="run"><a href="#run" class="header-anchor">#</a> run</h3> <ul><li>类型：<code>(callback: (env: Env) =&gt; void | Promise&lt;void&gt;) =&gt; Promise&lt;void&gt;</code></li> <li>说明：用App执行特定逻辑。可以在回调参数中获取当前App的运行环境，详见<a href="#env">Env</a></li></ul> <h2 id="connector"><a href="#connector" class="header-anchor">#</a> Connector</h2> <p><code>Connector</code>是用来访问其他App的状态事件和方法的对象，可以通过<a href="#connect">app.connect</a>方法获取。<code>Connector</code>的属性和方法是<a href="#app">App</a>的子集，包括</p> <ul><li><a href="#name">name</a></li> <li><a href="#state">state</a></li> <li><a href="#events">events</a></li> <li><a href="#methods">methods</a></li> <li><a href="#setstate">setState</a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果连接的App声明了状态的可访问性<code>isPrivate</code>为<code>true</code>，那么通过Connector调用<code>setState</code>更改App的状态将报错</p></div> <ul><li><a href="#watchstate">watchState</a></li> <li><a href="#lisenevents">listenEvents</a></li></ul> <p>以上属性和方法的使用方式与App的使用方式是完全一致的</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>connect操作并不会加载和激活要连接的App，因此，如果你要连接一个App并使用它的状态，应该保证在访问<code>Connector.state</code>之前，连接的App已经被加载并初始化了状态。你可以将要连接的App声明为当前App的<a href="/guide/advance.html#关联和依赖">关联或依赖</a>，也可以手动加载或激活要连接的App</p></div> <h2 id="registerapp"><a href="#registerapp" class="header-anchor">#</a> registerApp</h2> <p>registerApp方法可以直接通过<code>import { registerApp } from 'rallie'</code>导入</p> <ul><li>类型：<code>(app: App) =&gt; Registrant</code></li> <li>说明：注册App实例，只有注册过的App才能被其他App<a href="#load">加载</a>、<a href="#activate">激活</a>和<a href="#destroy">卸载</a>。该方法将返回一个<a href="#registrant">Registrant</a>对象</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> registerApp<span class="token punctuation">,</span> App <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rallie'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token string">'my-app'</span><span class="token punctuation">)</span>
<span class="token function">registerApp</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">relyOn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lib:react'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">relateTo</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'your-app'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do the bootstrap</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do the destroy</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></li></ul> <h2 id="registrant"><a href="#registrant" class="header-anchor">#</a> Registrant</h2> <p>通过调用<code>registerApp</code>获得，用于声明注册的App的<a href="/guide/advance.html#关联和依赖">关联和依赖</a>，以及<a href="/guide/advance.html#生命周期">生命周期</a>，支持链式调用</p> <h3 id="relateto"><a href="#relateto" class="header-anchor">#</a> relateTo</h3> <ul><li>类型：<code>(Array&lt;string | { name: string, ctx: Record&lt;string, any&gt; }&gt;) =&gt; Registrant</code></li> <li>说明：声明当前App关联的App，接收的参数是一个数组，包含要关联的App列表，数组项可以是关联App的名称字符串，也可以是一个对象，包含<code>name</code>属性（关联App的名称）和<code>ctx</code>属性（传递给资源加载中间件的上下文）。多次调用<code>relateTo</code>方法会对原来的关联数组进行去重追加</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">registerApp</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">relateTo</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lib:react'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'lib:react-dom'</span><span class="token punctuation">,</span> ctx<span class="token operator">:</span> <span class="token punctuation">{</span> version<span class="token operator">:</span> <span class="token string">'17.0.2'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="relyon"><a href="#relyon" class="header-anchor">#</a> relyOn</h3> <ul><li>类型：<code>(Array&lt;string | { name: string, data: any, ctx: Record&lt;string, any&gt; }&gt;) =&gt; Registrant</code></li> <li>说明：声明当前App依赖的App，接收的参数是一个数组，包含依赖的App列表，数组项可以是依赖App的名称字符串，也可以是一个对象，包含<code>name</code>属性（依赖App的名称）、<code>data</code>属性（传递给依赖app的生命周期激活参数）和<code>ctx</code>属性（传递给资源加载中间件的上下文）。多次调用<code>relyOn</code>方法会对原来的依赖数组进行去重追加</li> <li>示例：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">registerApp</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">relyOn</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'lib:react'</span><span class="token punctuation">,</span> 
    <span class="token punctuation">{</span> 
      name<span class="token operator">:</span> <span class="token string">'layout-app'</span><span class="token punctuation">,</span> 
      ctx<span class="token operator">:</span> <span class="token punctuation">{</span> 
        version<span class="token operator">:</span> <span class="token string">'17.0.2'</span><span class="token punctuation">,</span> 
        data<span class="token operator">:</span> <span class="token punctuation">{</span> 
          lang<span class="token operator">:</span> <span class="token string">'en'</span><span class="token punctuation">,</span>
          theme<span class="token operator">:</span> <span class="token string">'dark'</span>
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="onbootstrap"><a href="#onbootstrap" class="header-anchor">#</a> onBootstrap</h3> <ul><li>类型：<code>(callback: (data: any) =&gt; void | Promise&lt;void&gt;) =&gt; Registrant</code></li> <li>说明：声明bootstrap阶段的回调，参考<a href="/guide/advance.html#生命周期">生命周期</a></li></ul> <h3 id="onactivate"><a href="#onactivate" class="header-anchor">#</a> onActivate</h3> <ul><li>类型：<code>(callbak: (data: any) =&gt; void | Promise&lt;void&gt;) =&gt; Registrant</code></li> <li>说明：声明activate阶段的回调，参考<a href="/guide/advance.html#生命周期">生命周期</a></li></ul> <h3 id="ondestroy"><a href="#ondestroy" class="header-anchor">#</a> onDestroy</h3> <ul><li>类型：<code>(callback: (data: any) =&gt; void | Promise&lt;void&gt;) =&gt; Registrant</code></li> <li>说明：声明destroy阶段的回调，参考<a href="/guide/advance.html#生命周期">生命周期</a></li></ul> <h2 id="env"><a href="#env" class="header-anchor">#</a> Env</h2> <p>App的运行环境对象，可以在<code>App.run</code>方法的回调中获得</p> <h3 id="isentry"><a href="#isentry" class="header-anchor">#</a> isEntry</h3> <ul><li>类型：<code>boolean</code></li> <li>说明：是否是入口环境。如果一个App是应用集群中第一个被创建的应用，则在执行App的<code>run</code>方法时，其回调参数<code>env.isEntry</code>为<code>true</code>，否则为<code>false</code></li></ul> <h3 id="freeze"><a href="#freeze" class="header-anchor">#</a> freeze</h3> <ul><li>类型：<code>() =&gt; void</code></li> <li>说明：冻结当前运行环境，只有当<code>env.isEntry</code>为<code>true</code>时，该方法才有效。当运行环境被冻结后，非入口环境的App应用的中间件和配置将不生效</li></ul> <h3 id="unfreeze"><a href="#unfreeze" class="header-anchor">#</a> unfreeze</h3> <ul><li>类型：<code>() =&gt; void</code></li> <li>说明：解冻当前运行环境，只有当<code>env.isEntry</code>为<code>true</code>时，该方法才有效。</li></ul> <h3 id="use"><a href="#use" class="header-anchor">#</a> use</h3> <ul><li>类型：<code>(middleware: (ctx: Context, next: () =&gt; Promise&lt;void&gt;) =&gt; void) =&gt; void</code></li> <li>说明：应用资源加载中间件，使用方式参考<a href="/guide/advance.html#中间件">中间件</a>，context的类型为：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 要加载的app的名字</span>
  conf<span class="token operator">:</span> ConfType<span class="token punctuation">;</span> <span class="token comment">// 运行环境的配置，参考env.conf</span>
  <span class="token function-variable function">loadScript</span><span class="token operator">:</span> <span class="token punctuation">(</span>script<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>HTMLScriptElement<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> HTMLScriptElement<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// 插入script脚本的方法</span>
  <span class="token function-variable function">loadLink</span><span class="token operator">:</span> <span class="token punctuation">(</span>link<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>HTMLLinkElement<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> HTMLLinkElement<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// 插入Link标签的方法</span>
  <span class="token punctuation">[</span>other<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="conf"><a href="#conf" class="header-anchor">#</a> conf</h3> <ul><li>类型：<div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">ConfType</span> <span class="token punctuation">{</span>
  assets<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    js<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    css<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>other<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>说明：运行环境的全局配置，可以通过<code>env.config</code>进行配置。其中<code>assets</code>属性是应用集群的资源路径信息，rallie的洋葱圈中间件模型的最内层中间件会根据app的名字在<code>assets</code>中查找应用资源并加载</li></ul> <h3 id="config"><a href="#config" class="header-anchor">#</a> config</h3> <ul><li>类型：<code>(conf: ConfType) =&gt; void</code></li> <li>说明：对运行环境进行配置。在配置<code>assets</code>时，配置的信息将会追加，而不会覆盖。<div class="language-ts extra-class"><pre class="language-ts"><code>env<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  assets<span class="token operator">:</span> <span class="token punctuation">{</span>
    bar<span class="token operator">:</span> <span class="token punctuation">{</span>
      js<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'bar.js'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
env<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  assets<span class="token operator">:</span> <span class="token punctuation">{</span>
    foo<span class="token operator">:</span> <span class="token punctuation">{</span>
      js<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'foo.js'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>assets<span class="token punctuation">)</span>
<span class="token comment">/*
  {
    bar: {
      js: ['bar.js']
    },
    foo: {
      js: ['foo.js']
    }
  }
*/</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ralliejs/docs/edit/main/api/index.md" target="_blank" rel="noopener noreferrer">在Github上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5c31735b.js" defer></script><script src="/assets/js/2.2db9e384.js" defer></script><script src="/assets/js/9.ae449379.js" defer></script>
  </body>
</html>
